//日志记录
{
  "log": {
    "disabled": false,
    "level": "warn", //日志详细记录
    "output": "",
    "timestamp": false //打开标注日志时间  
  },
  "experimental": {
    "clash_api": {
      "external_controller": "127.0.0.1:20123",
      "external_ui": "",
      "external_ui_download_url": "",
      "external_ui_download_detour": "🎯 全球直连",
      "secret": "", //// 留空自动生成随机密钥
      //工作模式rule/global/Enhanced
      "default_mode": "Enhanced",
      "access_control_allow_origin": ["http://localhost:*"], // 限制控制台访问源
      "access_control_allow_private_network": false
    },
    "cache_file": {
      //启用缓存 规则集  
      "enabled": true,
      //缓存路径
      "path": "cache.db",
      "cache_id": "cache.db",
      // 禁用FakeIP持久化,更隐秘
      "store_fakeip": false,
      //持久化已拒绝的dns响应
      "store_rdrc": false,
      "rdrc_timeout": "7d"
    }
  },
  "ntp": {
    "enabled": true,
    "server": "time.apple.com",
    "server_port": 123,
    "interval": "30m"
  },
  //进站监控
  "inbounds": [
    {
      "type": "mixed",
      "tag": "mixed-in",
      "listen": "127.0.0.1",
      "listen_port": 20122,
      "tcp_fast_open": false,
      "tcp_multi_path": false,
      "udp_fragment": false
    },
    {
      "type": "tun",
      "tag": "tun-in",
      "interface_name": "",
      "address": [
        "172.18.0.1/30",
        "fdfe:dcba:9876::1/126"
      ],
      "mtu": 1450, // 优化iOS的MTU值
      "auto_route": true,
      "strict_route": true,
      "sniff": true,
      "endpoint_independent_nat": false, // 提升NAT兼容性
      "domain_strategy": "prefer_ipv4",
      //mixed、system、gvisor  
      //这三个的区别system 性能:高、安全性:低、兼容性:高(依赖系统)、复杂性:简单、 适用场景：性能优先
      //           gvisor 性能:低、安全性:高、兼容性:中         、复杂性:较复杂、适用场景：安全隔离
      //           mixed  上面两个的集合体，都中等
      "stack": "mixed",
      "platform": {
        //http代理
        "http_proxy": {
          "enabled": true,
          "server": "127.0.0.1",
          "server_port": 20122
        }
      }
    }
  ],
  //出站设置
  "outbounds": [
    //直连
    {
      "type": "direct",
      "tag": "🎯 全球直连"
    },
    //全局
    {
      "type": "selector",
      "tag": "GLOBAL",
      "interrupt_exist_connections": true,
      "outbounds": [
        "🚀 节点选择",
        "🎈 自动选择",
        "🎯 全球直连",
        "🐟 漏网之鱼"
      ]
      //"default": "手动选择"  这条可以让规则选一个默认的
    },
    {
      "type": "selector",
      "tag": "🚀 节点选择",
      "interrupt_exist_connections": true,
      "outbounds": [
        "🎈 自动选择",
        "已中转kookeey",
        "kookeey链式",
        "proxy2"
      ]
    },
    {
      "type": "urltest",
      "tag": "🎈 自动选择",
      "url": "https://www.gstatic.com/generate_204",
      "interval": "3m",
      "tolerance": 150,
      "interrupt_exist_connections": true,
      "outbounds": [
        "已中转kookeey",
        "kookeey链式",
        "proxy2"
      ]
    },
    {
      "type": "selector",
      "tag": "🐟 漏网之鱼",
      "interrupt_exist_connections": true,
      "outbounds": [
        "🚀 节点选择",
        "🎯 全球直连"
      ]
    },
    //个人的节点
    {
      "type": "socks",
      "tag": "已中转kookeey",
      "server": "100.bgp.666888.biz",
      "server_port": 46867,
      "username": "5258f8e2",
      "password": "56864eaa",
      "version": "5"
      "tls": {
        "enabled": true,
        "server_name": "100.bgp.666888.biz",
        "insecure": false
      }
    },
    {
      "type": "socks",
      "tag": "kookeey链式",
      "server": "204.242.254.64",
      "server_port": 31012,
      "detour": "proxy2",
      "username": "5258f8e2",
      "password": "56864eaa",
      "version": "5"
    },
    //{
    //"type": "vmess",
    //"tag": "proxy2",
    //"server": "c50s2.portablesubmarines.com",
    //"server_port": 19868,
    //"uuid": "30a5efe1-3235-4b93-a8ee-71b1d1834c5b",
    //"security": "auto",
    //"alter_id": 0
    //}
    {
      "type": "shadowsocks",
      "tag": "proxy2",
      "server": "c50s2.portablesubmarines.com",
      "server_port": 7395,
      "method": "chacha20-ietf-poly1305",
      "password": "kQBeCDXbwoSW2wVC",
      "plugin": "obfs-local", //启用HTTP流量混淆插件
      "plugin_opts": "host=cloudflare.com;path=/ws;tls", // 升级为WebSocket+TLS混淆
      "network": "udp",
      "udp_over_tcp": true, // 强制UDP over TCP
      "multiplex": {}
    }
  ],
  //出站的规则分流
  "route": {
    "rules": [
      {
        "action": "sniff", //嗅探进站网络
        "inbound": [
          "tun-in",
          "mixed-in"
        ]
      },
      //进站来的都从域解析到ip，ipv4优先
      {
        "inbound": [
          "tun-in",
          "mixed-in"
        ],
        "action": "resolve",
        "strategy": "prefer_ipv4"
      },
      // ===== DNS规则 (官方推荐动作) =====
      //拦截dns
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          {
            "port": 53
          },
          {
            "protocol": "dns"
          }
        ],
        "action": "hijack-dns"
      },
      //去广告
      {
        "rule_set": [
          "Category-Ads"
        ],
        "action": "reject"
      },
      {
        "rule_set": [
          "BlockHttpDNS"
        ],
        "action": "reject"
      },
      // ===== 拒绝动作 (官方标准写法) =====
      {
        "domain_keyword": [
          "stun:",
          "turn:",
          "webrtc",
          "quic"
        ],
        "action": "reject"
      },
      // 增强WebRTC阻止
      {
        "action": "reject",
        "domain_regex": "^(stun|turn|webrtc)\\."
      },
      // 阻止未加密QUIC协议
      {
        "action": "reject",
        "protocol": [
          "quic"
        ]
      },
      // 阻止UDP潜在泄露
      {
        "port": [
          443
        ],
        "network": "udp",
        "action": "reject"
      },
      // 新增隐私保护规则
      {
        "action": "reject",
        "domain_keyword": [
          "analytics",
          "tracking"
        ]
      },
      {
        "port": [
          3478,
          5349,
          19302,
          19305
        ],
        "action": "reject"
      },
      // 添加隐私保护规则（置于广告规则后）
      {
        "rule_set": [
          "Tracking",
          "Tracker"
        ],
        "action": "reject"
      },

      // 新增隐私敏感协议拦截
      {
        "protocol": ["ftp", "telnet", "smtp"],
        "action": "reject"
      },
      // 强化追踪拦截
      {
        "domain_regex": "(analytics|track|metrics|telemetry)\\.",
        "action": "reject"
      },

      


      
      // ===== 内置动作 (官方推荐) =====
      {
        "ip_cidr": [
          "10.0.0.0/8",
          "172.16.0.0/12",
          "192.168.0.0/16",
          "198.18.0.0/15",
          "fc00::/7"
        ],
        "action": "direct"
      },
      {
        "ip_is_private": true,
        "action": "route",
        "outbound": "🎯 全球直连"
      },

      //页面的模式
      {
        "action": "route",
        "clash_mode": "direct",
        "outbound": "🎯 全球直连"
      },
      {
        "action": "route",
        "clash_mode": "global",
        "outbound": "GLOBAL"
      },
      
      // ===== 出站动作 =====
      {
        "domain_suffix": [
          ".apple.com",
          ".icloud.com",
          ".mzstatic.com"
        ],
        "outbound": "🎯 全球直连"
      },
      
      //走直连的规则
      {
        "action": "route",
        "rule_set": [
          "GeoSite-Private",
          "GeoSite-CN",
          "GeoIP-Private",
          "geoip-cn",
          "geosite-geolocation-cn",
          "PayPal"
        ],
        "outbound": "🎯 全球直连"
      },
      //合并例子"mode": "or" "and" {"type": "logical","mode": "or","rules":[{"protocol": "dns"},{"port": 53}//],//"outbound": "dns"//},
      //以下规则分流走节点
      {
        "domain_keyword": [
          "banking",
          "financial",
          "secret"
        ],
        "outbound": "🚀 节点选择"
      },
      // 走代理的规则：非中国域名
      {
        "action": "route",
        "rule_set": [
          "geosite-geolocation-!cn"
        ],
        "outbound": "🚀 节点选择"
      },
      // 支付服务走代理（安全加固）
      {
        "domain_suffix": [
          ".stripe.com",
          ".venmo.com"
        ],
        "outbound": "🚀 节点选择"
      },
      {
        "action": "route",
        "rule_set": [
          "Youtube",
          "Tiktok",
          "Whatsapp",
          "Instagram",
          "Facebook",
          "GitHub",
          "Line",
          "Telegram"
        ],
        "outbound": "🚀 节点选择"
      }
    ],
    //出站的分流规则集
    "rule_set": [
      //油管规则集
      {
        "tag": "Youtube",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/youtube.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      },
      //TK规则集
      {
        "tag": "Tiktok",
        "type": "remote",
        "url": "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/sing/geo/geosite/tiktok.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      },
      //WHATSAPP规则集
      {
        "tag": "Whatsapp",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/whatsapp.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      },
      //INSD规则集
      {
        "tag": "Instagram",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/instagram.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      },
      //FB规则集
      {
        "tag": "Facebook",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/facebook.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      },
      {
        "tag": "Category-Ads",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/category-ads-all.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },
      {
        "tag": "GeoIP-Private",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geoip/private.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },
      {
        "tag": "GeoSite-Private",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/private.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },
      {
        "tag": "GeoSite-CN",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/cn.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },
      {
        "tag": "geoip-cn",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geoip/cn.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },
      {
        "tag": "geosite-geolocation-cn",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/geolocation-cn.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },
      {
        "tag": "geosite-geolocation-!cn",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/geolocation-!cn.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },
      //网上别人做的转sing-box的中国 规则地址
      {
        "tag": "PayPal",
        "type": "remote",
        "url": "https://cdn.jsdelivr.net/gh/senshinya/singbox_ruleset@main/rule/PayPal/PayPal.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },
      {
        "tag": "Tracking",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/category-public-tracker.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },

      {
        "tag": "Tracker",
        "type": "remote",
        "url": "https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@sing/geo/geosite/tracker.srs",
        "format": "binary",
        "download_detour": "🎯 全球直连"
      },

      
      {
        "tag": "GitHub",
        "type": "remote",
        "url": "https://cdn.jsdelivr.net/gh/senshinya/singbox_ruleset@main/rule/GitHub/GitHub.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      },
      {
        "tag": "Line",
        "type": "remote",
        "url": "https://cdn.jsdelivr.net/gh/senshinya/singbox_ruleset@main/rule/Line/Line.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      },
      {
        "tag": "Telegram",
        "type": "remote",
        "url": "https://cdn.jsdelivr.net/gh/senshinya/singbox_ruleset@main/rule/Telegram/Telegram.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      },
      //拒绝的dns
      {
        "tag": "BlockHttpDNS",
        "type": "remote",
        "url": "https://cdn.jsdelivr.net/gh/senshinya/singbox_ruleset@main/rule/BlockHttpDNS/BlockHttpDNS.srs",
        "format": "binary",
        "download_detour": "🚀 节点选择"
      }
    ],
    //自动检测出站接口
    "auto_detect_interface": true,
    "default_mark": 233,
    //查找进程信息
    "find_process": true,
    //没在规则里的走指定规则
    "final": "🐟 漏网之鱼"
  },
  //以下是dns服务和规则设置
  "dns": {
    "servers": [
      {
        "tag": "Local-DNS",
        "address": "h3://223.5.5.5:443/dns-query",
        "address_resolver": "Local-DNS-Resolver",
        "detour": "🎯 全球直连"
      },

      {
        "tag": "Local-DNS-Resolver",
        "address": "udp://223.5.5.5:53",
        "detour": "🎯 全球直连"
      },

      
      {
        "tag": "Remote-DNS",
        "address": "tls://9.9.9.9:853",  // Quad9的DoT
        "detour": "🚀 节点选择"
      },

      {
        "tag": "Remote-DNS1",
        "address": "https://1.1.1.1/dns-query", // 使用Cloudflare的DoH
        "detour": "🚀 节点选择"
      },
      
      //fakeip的设置
      {
        "address": "fakeip",
        "tag": "fakeip"
      },
      {
        "address": "rcode://success",
        "tag": "block"
      }
    ],
    //dns的规则
    "rules": [
      {
        "action": "route",
        "server": "Local-DNS",
        "outbound": "any"
      },
      //{
      //"inbound":[
      //"tun-in",
      //"mixed-in"
      //],
      //"server": "Local-DNS"
      //},
      {
        "action": "route",
        "clash_mode": "direct",
        "server": "Local-DNS"
      },
      {
        "action": "route",
        "clash_mode": "global",
        "server": "Remote-DNS"
      },
      {
        "action": "route",
        "rule_set": [
          "GeoSite-CN"
        ],
        "server": "Local-DNS"
      },
      {
        "action": "route",
        "rule_set": [
          "geosite-geolocation-cn"
        ],
        "server": "Local-DNS"
      },
      {
        "action": "route",
        "rule_set": [
          "geosite-geolocation-!cn"
        ],
        "server": "Remote-DNS"
      },
      {
        //"action": "route",
        //"rule_set": "geosite-geolocation-!cn",
        "query_type": [
          "A",
          "AAAA"
        ],
        "server": "fakeip"
      },

      
    ],
    "strategy": "prefer_ipv4", //默认ipv4优选
    "disable_cache": false,
    "disable_expire": false,
    "independent_cache": true,
    //没找到的dns走指定
    "final": "Remote-DNS",
    "fakeip": {
      "enabled": true,
      "inet4_range": "198.18.0.0/15",
      "inet6_range": "fc00::/18"
    }
  }
}
